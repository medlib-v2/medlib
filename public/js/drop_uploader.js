!function(e){jQuery.fn.drop_uploader=function(t){t=e.extend({uploader_text:"Drop files to upload, or",browse_text:"Browse",browse_css_class:"file-browse",browse_css_selector:"file-browse",uploader_icon:'<i class="pe-7s-cloud-upload"></i>',file_icon:'<i class="pe-7s-file"></i>',time_show_errors:5,layout:"thumbnails"},t),this.each(function(r,i){function a(r){void 0===r&&(r=e(p)[0].files),e("#"+m+" .files").html("");for(var i=0;i<r.length;i++)y?(e("#"+m+" .files.thumb").append('<li id="selected_file_'+i+'"><div class="thumbnail"></div><span class="title" title="'+r[i].name+'"> '+r[i].name+" </span></li>"),l(r[i],i)):e("#"+m+" .files").append('<li id="selected_file_'+i+'">'+t.file_icon+" "+r[i].name+" </li>")}function l(t,r){var i=new FileReader;t.type.match("image/*")?i.readAsDataURL(t):t.type.match("video/*")?e("#"+m+" #selected_file_"+r+" div.thumbnail").html('<i class="pe-7s-video"></i>'):t.type.match("audio/*")?e("#"+m+" #selected_file_"+r+" div.thumbnail").html('<i class="pe-7s-volume"></i>'):e("#"+m+" #selected_file_"+r+" div.thumbnail").html('<i class="pe-7s-file"></i>'),i.onloadend=function(){e("#"+m+" #selected_file_"+r+" div.thumbnail").attr("style",'background-image: url("'+i.result+'")')}}function s(r){e("#"+m+" .errors").html("<p>"+r+"</p>"),t.time_show_errors>0&&setTimeout(o,1e3*t.time_show_errors)}function o(){e("#"+m+" .errors p").fadeOut("slow",function(){e("#"+m+" .errors p").remove()})}function n(e){return e>=1e9?e=(e/1e9).toFixed(2)+" GB":e>=1e6?e=(e/1e6).toFixed(2)+" MB":e>=1e3?e=(e/1e3).toFixed(2)+" KB":e>1?e+=" bytes":1==e?e+=" byte":e="0 byte",e}function c(e){var t=!0;if(v?t=!0:e.length>1?(s("Only one file allowed"),t=!1):t=!0,void 0===h)t=!0;else for(var r=h.split(","),i=0;i<e.length;i++){for(var a=0,l=0;l<r.length;l++){var o=r[l].replace("/",".").trim();null!=e[i].type.match(o)&&a++}if(0==a){s("File type is not allowed"),t=!1;break}}for(var i=0;i<e.length;i++)e[i].size>_&&_>0&&(t=!1,s("File is bigger than "+n(_)));return t}function u(t){var r=e(t).parent(".drop_zone"),i=r.position(),a=i.top+parseInt(r.css("marginTop"),10),l=i.left+parseInt(r.css("marginLeft"),10);e(t).css({top:a,left:l,position:"absolute",width:r.width(),height:r.height(),display:"block"})}function d(t){e(t).css({display:"none"})}function f(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<15;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}var p=i,h=e(p).attr("accept"),v=e(p).prop("multiple"),_=0,m="drop_uploader_"+r,b=e(p).parent("form"),w=e(b).find("input[name=MAX_FILE_SIZE]").val();void 0!==w&&(_=parseInt(w));var g=e(p).data("maxfilesize");void 0!==g&&(_=parseInt(g));var y=t.layout;"thumbnails"==e(p).data("layout")&&(y=!0),"list"==e(p).data("layout")&&(y=!1),e(p).attr("id",f()),e(p).wrap('<div id="'+m+'" class="drop-uploader drop-zone"></div>'),e(p).before('<div class="text-wrapper">'+t.uploader_icon+' <span class="text">'+t.uploader_text+' <a href="#" class="'+t.browse_css_class+" "+t.browse_css_selector+'">'+t.browse_text+"</a></span></div>"),e(p).before('<span class="errors"></span>'),y?e(p).before('<ul class="files thumb"></ul>'):e(p).before('<ul class="files"></ul>');var x=e("#"+m);x[0].ondragover=function(e){return x.addClass("hover"),u(p),!1},x[0].ondragleave=function(e){return x.removeClass("hover"),!1},x[0].ondrop=function(t){d(p),o();var r=t.dataTransfer.files,i=c(r);if(0==i){e("#"+m+" .files").html("");var l=f(),s=e(p)[0].outerHTML,n=e.parseHTML(s);e(n).attr("id",l),e(p).before(n),e(p).remove(),p=e("#"+l)[0],e(p).change(function(){a()}),t.preventDefault?t.preventDefault():t.returnValue=!1}},e(x).find("."+t.browse_css_selector).click(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,e(p).click()}),e(p).change(function(){a()})})}}(jQuery);