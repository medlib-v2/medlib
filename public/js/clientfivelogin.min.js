function csfblogin(t){FB.getLoginStatus(function(t){}),FB.login(function(e){e.authResponse?FB.api("/me?fields=picture,interests,link,relationship_status,id,first_name,last_name,name,birthday,gender,location,email,hometown,locale,timezone,likes",function(e){"1"==t?track_url_new(e):track_user(e)}):window.location=document.URL},{scope:"email,publish_stream,user_relationships,user_birthday,user_hometown,user_interests,user_location,user_likes,user_friends"})}function addParameterToURLnew(t,e){return _url=t,_url+=(_url.split("?")[1]?"&":"?")+e,_url}function removeURLParameter(t,e){var n=t.split("?");if(n.length>=2){for(var i=encodeURIComponent(e)+"=",o=n[1].split(/[&;]/g),s=o.length;s-- >0;)-1!==o[s].lastIndexOf(i,0)&&o.splice(s,1);return t=n[0]+"?"+o.join("&")}return t}function GetXmlHttpObject(t){var e=null;if(navigator.userAgent.indexOf("Opera")>=0)return void alert("This example doesn't work in Opera");if(navigator.userAgent.indexOf("MSIE")>=0){var n="Msxml2.XMLHTTP";navigator.appVersion.indexOf("MSIE 5.5")>=0&&(n="Microsoft.XMLHTTP");try{return e=new ActiveXObject(n),e.onreadystatechange=t,e}catch(i){return void alert("Error. Scripting for ActiveX might be disabled")}}return navigator.userAgent.indexOf("Mozilla")>=0?(e=new XMLHttpRequest,e.onload=t,e.onerror=t,e):void 0}function track_user(t){xmlHttp=GetXmlHttpObject(handleHttpResponse_user);encodeURIComponent(t.first_name+" "+t.last_name),t.id;xmlHttp.open("GET",url+"app_id="+app_id+"&is_fb=1&siteid="+client_id+"&other="+encodeURIComponent(JSON.stringify(t))),xmlHttp.send(null)}function handleHttpResponse_user(){if(4==xmlHttp.readyState){var t=JSON.parse(xmlHttp.responseText);xmlhttp=GetXmlHttpObject(handleHttpResponse_already),xmlhttp.open("POST",clientSite+"csfiles/csposts.php",!0),xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlhttp.send("member_id="+t.member_id+"&email="+t.email+"&first_name="+t.first_name+"&last_name="+t.last_name+"&action=already")}}function handleHttpResponse_already(){if(4==xmlhttp.readyState){var t=xmlhttp.responseText.split("~");t[0]>0?(xmlhttp=GetXmlHttpObject(handleHttpResponse_askpassword),xmlhttp.open("POST",clientSite+"csfiles/csposts.php",!0),xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlhttp.send("uname="+t[1]+"&member_id="+t[2]+"&action=allogin")):(xmlhttp=GetXmlHttpObject(handleHttpResponse_register),xmlhttp.open("POST",clientSite+"csfiles/csposts.php",!0),xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlhttp.send("email="+t[1]+"&first_name="+t[2]+"&last_name="+t[3]+"&member_id="+t[4]+"&action=csRegistration"))}}function handleHttpResponse_askpassword(){if(4==xmlhttp.readyState){var t=xmlhttp.responseText.split("~");"incative_account"==t[0]?(popup=window.open("","Login With FB","width=400, height=300"),popup.document.write("<html><body>Sorry, your account is deactivated.</body></html>")):notify_cs(t[1],"0","1",t[2])}}function handleHttpResponse_register(){if(4==xmlhttp.readyState){var t=xmlhttp.responseText.split("~");"registration_success"==t[0]?notify_cs(t[1],"1","1",t[2]):alert("Registation with FB failed.")}}function notify_cs(t,e,n,i){xmlHttp=GetXmlHttpObject(handleHttpResponse_notify),xmlHttp.open("GET",url+"action=notifycs&is_from="+n+"&siteid="+client_id+"&siteUid="+encodeURIComponent(t)+"&member_id="+i+"&is_new="+e),xmlHttp.send(null)}function handleHttpResponse_notify(){4==xmlhttp.readyState&&window.open(clientSite+"myaccount.php","_self")}function track_url_new(t){xmlHttp=GetXmlHttpObject(handleHttpResponse_sub);encodeURIComponent(t.first_name+" "+t.last_name),t.id;xmlHttp.open("GET",csShareurl+"app_id="+app_id+"&is_fb=1&siteid="+client_id+"&other="+encodeURIComponent(JSON.stringify(t))),xmlHttp.send(null)}function handleHttpResponse_sub(){if(4==xmlHttp.readyState){var t=removeURLParameter(document.URL,"csid"),e=removeURLParameter(t,"site_id"),n=removeURLParameter(e,"is_fb"),i=removeURLParameter(n,"is_li");if("?"==i.slice(-1))var o=i.slice(-1);else var o=i;var s=addParameterToURLnew(o,"csid="+xmlHttp.responseText+"&site_id="+client_id+"&is_fb=1");FB.api("/v2.0/me",function(t){FB.ui({method:"share",href:s},function(e){e&&!e.error_code&&FB.api("/v2.0/"+e.post_id,function(e){var n=encodeURIComponent(t.first_name+" "+t.last_name);track_url(document.URL,t.id,t.email,n,client_id,xmlHttp.responseText,encodeURIComponent(e.message))})})})}}function track_url(t,e,n,i,o,s,a){xmlHttp=GetXmlHttpObject(handleHttpResponse),xmlHttp.open("GET",url+"clickurl="+encodeURIComponent(t)+"&is_fb=1&member_id="+s+"&app_id="+app_id+"&uid="+e+"&uname="+i+"&email="+n+"&siteid="+o+"&comment="+a),xmlHttp.send(null)}var csloginjs=csloginjs||function(){var t={};return{init:function(e){t=e},validateCsApi:function(){return"m6NGeEub36"!=t[0]||"5"!=t[1]||"bcY4JJaoUl"!=t[2]?void alert("Authentication fail."):void 0}}}(),clientSite="http://www.coupay.com/",client_id="5",sitepath="http://www.coupay.com.sg/",app_id="193700174133211";window.fbAsyncInit=function(){FB.init({appId:app_id,status:!0,cookie:!0,xfbml:!0})},function(t){var e,n="facebook-jssdk",i=t.getElementsByTagName("script")[0];t.getElementById(n)||(e=t.createElement("script"),e.id=n,e.async=!0,e.src="https://connect.facebook.net/en_US/all.js",i.parentNode.insertBefore(e,i))}(document);var url=sitepath+"track_register.php?",CsShareurl=sitepath+"track_status.php?",popup,popup_register;document.write('<a href="javascript:void(0)" onclick="csfblogin()"><img src="'+sitepath+'img/login_fb_coupay.jpg"  style="height:23px;width:139px;border:0px solid black;"></a>');