$(function(){function e(){"use strict";var e=33,t=Backbone.Model.extend({defaults:function(){return{sender:"",senderMail:"",subject:"",body:n[Math.round(3*Math.random())],receiver:"",timestamp:new Date((new Date).getTime()-72e5).getTime(),read:!0,starred:!1,attachment:!1,folderId:1,selected:!1}},markRead:function(){this.save({read:!0})},toggleStarred:function(){this.save({starred:!this.get("starred")})},toggleSelected:function(){this.save({selected:!this.get("selected")})}}),i=Backbone.Model.extend({defaults:{name:"",current:!1,order:3,unread:0},sync:function(){}}),l=Backbone.Collection.extend({model:i,url:"demo/json/folders.json",comparator:"order",parse:function(t){return t.push({name:"Starred",id:e,order:4}),t}}),a=new l,o=Backbone.View.extend({tagName:"li",template:_.template($("#folder-template").html()),events:{click:"selectFolder"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.attr("class",this.model.get("current")?"active":""),this.$el.html(this.template(this.model.toJSON())),this},selectFolder:function(){var e=this;a.each(function(t){t.save({current:t==e.model})}),p.showEmailsView()}}),r=window.EmailList=Backbone.Collection.extend({model:t,url:"demo/json/emails.json",comparator:function(e){return-e.get("timestamp")},search:function(e,t){if(""==e)return this.where({folderId:t});var i=new RegExp(e,"gi");return this.filter(function(e){return e.get("folderId")==t&&i.test(e.get("subject"))||i.test(e.get("sender"))})}}),c=new r,d=Backbone.View.extend({tagName:"tr",template:_.template($("#mail-item-template").html()),events:{"change .selected-checkbox":"toggleSelected","click .starred":"toggleStarred","click .name,.subject":"openEmail"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.attr("class",this.model.get("read")?"":"unread"),this.$el.html(this.template(this.model.toJSON())),this},formatDate:function(e){var t=new Date(e),i=new Date,s=new Date(i.getFullYear(),i.getMonth(),i.getDate());return t.getTime()>s?t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()):["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getDate()},toggleSelected:function(){this.model.toggleSelected()},toggleStarred:function(){this.model.toggleStarred()},openEmail:function(){this.model.save({read:!0}),p.setCurrentView(new h({model:this.model}))}}),h=Backbone.View.extend({template:_.template($("#email-view-template").html()),attributes:{id:"email-view","class":"email-view"},events:{"click #email-opened-reply":"replyEmail"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return $("#widget-email-header").html("<h4>"+this.model.get("subject")+'</h4><div class="widget-controls"><a href="#"><i class="fa fa-print"></i></a></div>'),$("#folder-stats").addClass("hide"),$("#back-btn").removeClass("hide"),this.$el.html(this.template(this.model.toJSON())),this},formatDate:function(e){var t=new Date(e),i=new Date,s=new Date(i.getFullYear(),i.getMonth(),i.getDate());if(t.getTime()>s)return t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());var n=Math.floor((i.getTime()-t.getTime())/864e5);return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getDate()+" ("+n+" days ago)"},replyEmail:function(){var e="<br/><br/><blockquote class='blockquote-sm'>"+this.model.get("body")+"</blockquote> <br/>",i=new t({body:e,receiver:this.model.get("sender")?this.model.get("sender"):this.model.get("senderMail"),subject:"Re: "+this.model.get("subject")});p.showComposeView(i)}}),m=Backbone.View.extend({template:_.template($("#compose-view-template").html()),attributes:{id:"compose-view","class":"compose-view"},events:{"click #compose-save-button, #compose-send-button, #compose-discard-button":"backToFolders"},render:function(){return $("#widget-email-header").html('<h4>Compose <span class="fw-semi-bold">New</span></h4>'),$("#folder-stats").addClass("hide"),$("#back-btn").removeClass("hide"),this.$el.html(this.template(this.model.toJSON())),this._initViewComponents(),this},backToFolders:function(){p.showEmailsView()},_initViewComponents:function(){this.$("textarea").wysihtml5({html:!0,customTemplates:s,stylesheets:[]})}}),u=Backbone.View.extend({tagName:"table",attributes:{id:"folder-view","class":"table table-striped table-emails table-hover"},template:_.template($("#folders-view-template").html()),events:{"change #toggle-all":"toggleAll"},initialize:function(){this.currentFolderEmails=new r,this.folders=a,this.listenTo(this.currentFolderEmails,"reset",this.renderEmails),this.listenTo(this.currentFolderEmails,"all",this.renderFolderActions),this.listenTo(this.currentFolderEmails,"destroy",this.renderEmails),this.listenTo(this.folders,"change",this.resetEmails)},render:function(){return $("#widget-email-header").html($("#email-list-view-header-template").html()),$("#folder-stats").removeClass("hide"),$("#back-btn").addClass("hide"),$("#select-all").on("click",$.proxy(this.selectAll,this)),$("#select-none").on("click",$.proxy(this.selectNone,this)),$("#select-read").on("click",$.proxy(this.selectRead,this)),$("#select-unread").on("click",$.proxy(this.selectUnread,this)),$("#mark-as-read").on("click",$.proxy(this.markSelectedAsRead,this)),$("#mark-as-unread").on("click",$.proxy(this.markSelectedAsUnread,this)),$("#delete").on("click",$.proxy(this.deleteEmails,this)),this.resetEmails(),this.delegateEvents(this.events),this},renderFolderActions:function(){var e=this.currentFolderEmails.where({selected:!0}).length,t=e==this.currentFolderEmails.length;this.$toggleAllCheckbox=this.$("#toggle-all"),this.$toggleAllCheckbox.prop("checked",t)},addOne:function(e){var t=new d({model:e});this.$el.find("tbody").append(t.render().el)},renderEmails:function(){this.reset(),this.currentFolderEmails.length?this.currentFolderEmails.each(this.addOne,this):this.$el.find("tbody").append('<tr><td colspan="100">Nothing here yet</td></tr>');var e=this.folders.where({current:!0})[0],t=(this.currentFolderEmails.where({read:!1}).length,"Inbox");e&&(t=e.get("name"))},reset:function(){this.$el.html(this.template())},resetEmails:function(){var t=this.folders.where({current:!0})[0],i=1;t&&(i=t.get("id")),i==e?this.currentFolderEmails.reset(c.where({starred:!0})):this.currentFolderEmails.reset(c.where({folderId:i}))},toggleAll:function(){var e=this.$toggleAllCheckbox.prop("checked");this.currentFolderEmails.each(function(t){t.save({selected:e})})},selectAll:function(){this.$toggleAllCheckbox.prop("checked",!0),this.toggleAll()},selectNone:function(){this.$toggleAllCheckbox.prop("checked",!1),this.toggleAll()},selectRead:function(){this.selectNone(),_(this.currentFolderEmails.where({read:!0})).each(function(e){e.save({selected:!0})})},selectUnread:function(){this.selectNone(),_(this.currentFolderEmails.where({read:!1})).each(function(e){e.save({selected:!0})})},search:function(){var e=this.folders.where({current:!0})[0],t=1;e&&(t=e.get("id")),this.currentFolderEmails.reset(c.search($("#mailbox-search").val(),t))},markSelectedAsRead:function(){_(this.currentFolderEmails.where({selected:!0})).each(function(e){e.save({read:!0})})},markSelectedAsUnread:function(){_(this.currentFolderEmails.where({selected:!0})).each(function(e){e.save({read:!1})})},deleteEmails:function(){_(this.currentFolderEmails.where({selected:!0})).each(function(e){e.destroy()})}}),f=new u,g=Backbone.View.extend({el:$("#content"),$content:$("#mailbox-content"),events:{"keyup #mailbox-search":"search","click #compose-btn":"handleComposeBtnClick","click #back-btn":"handleBackBtnClick"},initialize:function(){this.currentView=f,this.folders=a,this.listenTo(this.folders,"reset",this.renderFolders);var e=this;this.folders.fetch({success:function(){c.fetch({success:function(){e.render()},reset:!0})},reset:!0})},render:function(){this.$content.html(this.currentView.render().el)},setCurrentView:function(e){this.currentView!==f&&this.currentView.remove(),this.currentView=e,this.render()},renderFolders:function(){this.resetFoldersList(),this.folders.each(this.addFolder,this)},resetFoldersList:function(){this.$("#folders-list").html("")},addFolder:function(e){var t=new o({model:e});this.$("#folders-list").append(t.render().el)},search:function(){"function"==typeof this.currentView.search&&this.currentView.search()},showEmailsView:function(){this.currentView!=f&&this.setCurrentView(f)},handleComposeBtnClick:function(){return this.showComposeView(),!1},handleBackBtnClick:function(){return this.showEmailsView(),!1},showComposeView:function(e){e=e?e:new t({body:""}),this.setCurrentView(new m({model:e}))}}),p=new g}function t(){setTimeout(function(){$("#app-alert").removeClass("hide").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated bounceInLeft")})},3e3)}function i(){$("#wysiwyg").wysihtml5({html:!0,customTemplates:s,stylesheets:[]}),e(),t()}var s={emphasis:function(e,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-"+i+" btn-default' data-wysihtml5-command='bold' title='CTRL+B' tabindex='-1'><i class='glyphicon glyphicon-bold'></i></a><a class='btn btn-"+i+" btn-default' data-wysihtml5-command='italic' title='CTRL+I' tabindex='-1'><i class='glyphicon glyphicon-italic'></i></a></div></li>"},link:function(e,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='bootstrap-wysihtml5-insert-link-modal modal fade'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h4>"+e.link.insert+"</h4></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-link-url form-control'><label class='checkbox'> <input type='checkbox' class='bootstrap-wysihtml5-insert-link-target' checked>"+e.link.target+"</label></div><div class='modal-footer'><button class='btn btn-default' data-dismiss='modal'>"+e.link.cancel+"</button><button href='#' class='btn btn-primary' data-dismiss='modal'>"+e.link.insert+"</button></div></div></div></div><a class='btn btn-"+i+" btn-default' data-wysihtml5-command='createLink' title='"+e.link.insert+"' tabindex='-1'><i class='fa fa-share'></i></a></li>"},html:function(e,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-"+i+" btn-default' data-wysihtml5-action='change_view' title='"+e.html.edit+"' tabindex='-1'><i class='fa fa-pencil'></i></a></div></li>"}},n=["<p>Why painful the sixteen how minuter looking nor. Subject but why ten earnest husband imagine sixteen brandon. Are unpleasing occasional celebrated motionless unaffected conviction out. Evil make to no five they. Stuff at avoid of sense small fully it whose an. Ten scarcely distance moreover handsome age although. As when have find fine or said no mile. He in dispatched in imprudence dissimilar be possession unreserved insensible. She evil face fine calm have now. Separate screened he outweigh of distance landlord.</p>","somm text bodt. Reall small. ust few lines","<p>Lose john poor same it case do year we. Full how way even the sigh. Extremely nor furniture fat questions now provision incommode preserved. Our side fail find like now. Discovered travelling for insensible partiality unpleasing impossible she. Sudden up my excuse to suffer ladies though or. Bachelor possible marianne directly confined relation as on he.</p>","empty"];i(),Medlibpp.onPageLoad(i)});